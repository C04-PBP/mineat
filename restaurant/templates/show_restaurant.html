{% extends "base.html" %}

{% block meta %}
    <title>Restaurant Search</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
{% endblock meta %}

{% block content %}
<!-- Search Bar and Choice Box -->
<nav class="bg-white shadow-md p-4">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
        <div class="flex space-x-2 w-full">
            <!-- Search Options -->
            <select id="search-choice" class="border rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <option value="name">Search by Name</option>
                <option value="district">Search by District</option>
            </select>

            <!-- Search input -->
            <input 
                type="text" 
                id="search-input" 
                placeholder="Search..." 
                autocomplete="off" 
                class="flex-grow border rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
            >
        </div>
    </div>
</nav>

<!-- Search Results -->
<div id="search-results" class="max-w-7xl mx-auto p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for restaurant in restaurants %}
        <div class="restaurant-item bg-white shadow-md rounded-lg overflow-hidden">
            <div class="p-4">
                <h2 class="text-2xl font-bold">{{ restaurant.name }}</h2>
                <p class="text-gray-600">{{ restaurant.address }}</p>
                <h3 class="mt-4 text-lg font-semibold">Food and Beverages</h3>
                <ul class="mt-2 space-y-2">
                    {% for fnb_item in restaurant.fnb.all %}
                        <li class="bg-gray-50 p-2 rounded-md shadow-sm">
                            <strong>{{ fnb_item.name }}</strong><br>
                            <!-- <img src="{{ fnb_item.image }}" alt="{{ fnb_item.name }}" class="w-20 h-20 mt-1"><br>
                            <span class="text-gray-600">Description: {{ fnb_item.description }}</span><br>
                            <span class="text-gray-600">Price: Rp {{ fnb_item.price }}</span> -->
                        </li>
                    {% empty %}
                        <li>No food and beverages available.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    {% endfor %}
</div>

<script>
    $(document).ready(function() {
        function search() {
            let query = $('#search-input').val();
            let choice = $('#search-choice').val();
            let url = choice === 'district' ? 
                    "{% url 'restaurant:ajax_search_district' %}" : 
                    "{% url 'restaurant:ajax_search_restaurant' %}";
            let dataKey = choice === 'district' ? 'location_q' : 'q';

            $.ajax({
                url: url,
                method: 'GET',
                data: { [dataKey]: query },
                success: function(response) {
                    $('#search-results').html(response.html);
                },
                error: function(xhr, status, error) {
                    console.error('Search error:', error);
                }
            });
        }

        $('#search-input').on('keyup', function() {
            search();
        });

        $('#search-choice').on('change', function() {
            search();
        });
    });
</script>
{% endblock content %}