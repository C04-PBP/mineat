{% extends "base.html" %}

{% block meta %}
    <title>Restaurants</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
{% endblock meta %}

{% block content %}
<body class="bg-gray-700"></body>
<!-- Search Bar and Choice Box -->
<nav class="bg-gray-700 shadow-md p-4">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
        <div class="flex space-x-2 w-full">
            <!-- Search Options -->
            <select id="search-choice" class="border rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <option value="name">Search by Name</option>
                <option value="district">Search by District</option>
            </select>

            <!-- Search input -->
            <input 
                type="text" 
                id="search-input" 
                placeholder="Search..." 
                autocomplete="off" 
                class="flex-grow border rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
            >
        </div>
    </div>
</nav>

<div class="flex justify-center mt-6 mb-6 ">
    <a href="{% url 'restaurant:add_restaurant' %}" class="bg-sky-500 hover:bg-lime-500 text-white font-serif font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-105 mx-4">
        Add Restaurant
    </a>
</div>

<!-- Search Results -->
<div id="search-results" class="max-w-7xl mx-auto p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for restaurant in restaurants %}
    <a href="{% url 'restaurant:restaurant_details' %}?id={{ restaurant.id }}" 
    class="restaurant-item bg-blue-900 shadow-md rounded-lg overflow-hidden">
            <div class="p-4">
                <h2 class="text-2xl font-bold">{{ restaurant.name }}</h2>
                <p class="text-gray-600">{{ restaurant.address }}</p>
                <h1 class="text-4xl">Image PlaceHolder</h1>
            </div>
        </a>
    {% endfor %}
</div>

<script>
    $(document).ready(function() {
        function search() {
            let query = $('#search-input').val();
            let choice = $('#search-choice').val();
            let url = choice === 'district' ? 
                    "{% url 'restaurant:ajax_search_district' %}" : 
                    "{% url 'restaurant:ajax_search_restaurant' %}";
            let dataKey = choice === 'district' ? 'location_q' : 'q';

            $.ajax({
                url: url,
                method: 'GET',
                data: { [dataKey]: query },
                success: function(response) {
                    $('#search-results').html(response.html);
                },
                error: function(xhr, status, error) {
                    console.error('Search error:', error);
                }
            });
        }

        $('#search-input').on('keyup', function() {
            search();
        });

        $('#search-choice').on('change', function() {
            search();
        });
    });
</script>
{% endblock content %}